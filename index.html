<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-House POS System (Bank & QR Image)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { background-color: #f0f2f5; font-family: 'Sarabun', sans-serif; }
        .login-wrapper { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #212529 0%, #495057 100%); }
        .product-card { cursor: pointer; transition: 0.2s; border: none; overflow: hidden; height: 100%; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .product-img { height: 140px; object-fit: cover; width: 100%; }
        .sidebar { height: calc(100vh - 56px); overflow-y: auto; background: white; border-left: 1px solid #ddd; position: fixed; right: 0; width: 35%; }
        .main-content { margin-right: 35%; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        .bank-details-card { background: #f8f9fa; border-left: 5px solid #0d6efd; border-radius: 8px; }

        @media (max-width: 768px) {
            .sidebar { position: static; width: 100%; height: auto; }
            .main-content { margin-right: 0; }
        }
    </style>
</head>
<body>

<div id="app">

    <div v-if="isLoading" class="loading-overlay">
        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
        <h4 class="text-dark">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...</h4>
        <p class="text-muted">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡∏ö‡πâ‡∏≤‡∏ô {{ currentUser?.houseId }}</p>
    </div>

    <div v-if="!currentUser" class="login-wrapper">
        <div class="card shadow-lg p-4 border-0" style="width: 350px; border-radius: 15px;">
            <div class="text-center mb-4">
                <div class="bg-warning text-dark rounded-circle d-inline-flex justify-content-center align-items-center mb-3 shadow-sm" style="width: 70px; height: 70px;">
                    <i class="fas fa-cash-register fa-2x"></i>
                </div>
                <h4 class="fw-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h4>
            </div>
            <form @submit.prevent="login">
                <div class="form-floating mb-3">
                    <input type="text" v-model="loginForm.username" class="form-control" id="floatingInput" placeholder="Username">
                    <label for="floatingInput">Username</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" v-model="loginForm.password" class="form-control" id="floatingPassword" placeholder="Password">
                    <label for="floatingPassword">Password</label>
                </div>
                <div v-if="loginError" class="alert alert-danger py-2 small text-center rounded-3">{{ loginError }}</div>
                <button type="submit" class="btn btn-dark w-100 py-3 fs-5 rounded-pill shadow-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
        </div>
    </div>

    <div v-else>
        <nav class="navbar navbar-dark bg-dark px-3 sticky-top shadow-sm" style="height: 56px;">
            <span class="navbar-brand mb-0 h1 d-flex align-items-center">
                <div class="bg-warning text-dark rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 35px; height: 35px; font-size: 1rem; font-weight: bold;">
                    {{ currentUser.houseId }}
                </div>
                <div>
                    <div style="font-size: 1rem;">{{ configName }}</div>
                </div>
            </span>
            <button class="btn btn-outline-light btn-sm" @click="logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </nav>

        <div class="container-fluid p-0">
            <div class="row g-0">
                
                <div class="col-md-8 p-4 main-content">
                    <div class="row g-3">
                        <div class="col-lg-3 col-md-4 col-6" v-for="item in currentMenu" :key="item.id">
                            <div class="card product-card shadow-sm rounded-3" @click="addToCart(item)">
                                <img :src="item.image" class="product-img">
                                <div class="card-body text-center p-2">
                                    <h6 class="card-title text-truncate mb-1 fw-bold">{{ item.name }}</h6>
                                    <span class="badge bg-dark rounded-pill">{{ item.price }} ‡∏ø</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 sidebar p-4 d-flex flex-column shadow">
                    <h5 class="mb-3 border-bottom pb-2 fw-bold text-primary"><i class="fas fa-shopping-basket me-2"></i>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h5>
                    
                    <div class="flex-grow-1 overflow-auto mb-3">
                        <table class="table table-borderless align-middle mb-0">
                            <tr v-for="(item, index) in cart" :key="index" class="border-bottom">
                                <td>
                                    <div class="fw-bold">{{ item.name }}</div>
                                    <div class="text-muted small">{{ item.price }} x {{ item.qty }}</div>
                                </td>
                                <td class="text-end text-nowrap">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-secondary" @click="decreaseQty(index)">-</button>
                                        <span class="btn btn-light disabled text-dark fw-bold border" style="width:35px">{{ item.qty }}</span>
                                        <button class="btn btn-outline-primary" @click="increaseQty(index)">+</button>
                                    </div>
                                </td>
                                <td class="text-end fw-bold">{{ item.price * item.qty }}</td>
                            </tr>
                        </table>
                        <div v-if="cart.length === 0" class="text-center text-muted py-5">
                            <i class="fas fa-cart-arrow-down fa-3x mb-3 opacity-25"></i>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
                        </div>
                    </div>

                    <div class="bg-white p-3 rounded-3 shadow-sm border mb-3">
                        <h6 class="fw-bold fs-6"><i class="fas fa-user-tag me-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h6>
                        <div class="row g-2">
                            <div class="col-4">
                                <input type="text" v-model="queueNumber" class="form-control form-control-sm border-primary" placeholder="‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà *" required>
                            </div>
                            <div class="col-8">
                                <input type="text" v-model="customerName" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-3 rounded-3 shadow-sm border mb-3">
                        <h6 class="fw-bold fs-6"><i class="fas fa-ticket-alt me-2"></i>‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h6>
                        <div class="input-group input-group-sm">
                            <input type="text" v-model="promoCodeInput" class="form-control text-uppercase" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" :disabled="appliedPromo !== null">
                            <button v-if="!appliedPromo" class="btn btn-outline-success" @click="applyPromo">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                            <button v-else class="btn btn-danger" @click="removePromo">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                        <div v-if="promoMessage" :class="{'text-success': appliedPromo, 'text-danger': !appliedPromo}" class="small mt-2 fw-bold">
                            <i :class="appliedPromo ? 'fas fa-check-circle' : 'fas fa-times-circle'"></i> {{ promoMessage }}
                        </div>
                    </div>

                    <div class="bg-light p-3 rounded-3 border">
                        <div class="d-flex justify-content-between mb-2 text-muted" v-if="discountAmount > 0">
                            <span>‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                            <span>{{ subTotal }} ‡∏ø</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2 text-success fw-bold" v-if="discountAmount > 0">
                            <span><i class="fas fa-tags me-1"></i>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>
                            <span>-{{ discountAmount }} ‡∏ø</span>
                        </div>
                        <div class="d-flex justify-content-between fs-5 fw-bold mb-3 border-top pt-2">
                            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                            <span class="text-primary">{{ totalPrice }} ‡∏ø</span>
                        </div>

                        <button class="btn w-100 py-3 fs-5 shadow-sm fw-bold" 
                                :class="(cart.length > 0 && queueNumber) ? 'btn-success' : 'btn-secondary'"
                                :disabled="cart.length === 0 || !queueNumber" 
                                @click="showPaymentModal">
                            <i class="fas fa-money-bill-wave me-2"></i> ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </button>
                        <div v-if="cart.length > 0 && !queueNumber" class="text-danger small text-center mt-2">
                            * ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-university me-2"></i>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <span class="badge bg-warning text-dark fs-6 me-2">‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà {{ queueNumber }}</span>
                        <span v-if="customerName" class="fw-bold text-muted">‡∏Ñ‡∏∏‡∏ì {{ customerName }}</span>
                    </div>

                    <h6 class="text-muted mb-1">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h6>
                    <div v-if="discountAmount > 0" class="text-muted text-decoration-line-through fs-5">
                        {{ subTotal }} ‡∏ö‡∏≤‡∏ó
                    </div>
                    <h1 class="text-dark display-3 fw-bold mb-4">{{ totalPrice }} <span class="fs-5">‡∏ö‡∏≤‡∏ó</span></h1>
                    
                    <div v-if="currentQrImage" class="mb-4">
                        <div class="card p-2 d-inline-block bg-white shadow-sm border-0 rounded-4">
                            <img :src="currentQrImage" class="img-fluid rounded" style="width: 250px; height: 250px; object-fit: contain;" alt="QR Code ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢">
                        </div>
                        <p class="text-muted small mt-2"><i class="fas fa-camera me-1"></i> ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                    </div>
                    
                    <div class="bank-details-card p-3 text-start mx-auto shadow-sm" style="max-width: 350px;">
                        <p class="mb-1 text-muted small"><i class="fas fa-info-circle me-1"></i>‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</p>
                        <h5 class="fw-bold text-primary mb-2">{{ currentBankDetails.bankName }}</h5>
                        <p class="mb-1 fs-5">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <span class="fw-bold text-dark">{{ currentBankDetails.accNo }}</span></p>
                        <p class="mb-0">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <span class="fw-bold">{{ currentBankDetails.accName }}</span></p>
                    </div>
                </div>
                <div class="modal-footer justify-content-center bg-light">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" class="btn btn-success px-4 fw-bold" @click="confirmPayment">
                        <i class="fas fa-check-circle me-1"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const { createApp } = Vue;

    // ==========================================
    // üî¥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 8 ‡∏ö‡πâ‡∏≤‡∏ô
    // ==========================================
    const houseConfigs = {

        // ‡∏ö‡πâ‡∏≤‡∏ô 1 //
        "1": {
            name: "‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á‡πÄ‡∏à‡πä‡∏á",
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            },
            // üëá ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ QR Code ‡∏à‡∏≤‡∏Å Google Drive ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß)
            qrImage: "https://drive.google.com/file/d/1blYpuwXAAINvT17JF0GelkKp-m2kG8Yr/view?usp=drive_link", 
            scriptUrl: "https://script.google.com/macros/s/xxxxxx_SHEET_1_xxxxxx/exec", 
            menu: [
                { id: 101, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: 'https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?w=300' },
                { id: 102, name: '‡∏•‡∏≤‡πÄ‡∏ï‡πâ‡πÄ‡∏¢‡πá‡∏ô', price: 50, image: 'https://images.unsplash.com/photo-1461023058943-716d192f2279?w=300' }
            ],
            promoGroups: [] 
        },

        // ‡∏ö‡πâ‡∏≤‡∏ô 2 //
        "2": { 
            name: "Summer splash",
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            }, 
            qrImage: "",
            scriptUrl: "", 
            menu: [
                { id: 201, name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°', price: 50, image: '' }

            ] 
        },
        
        // ‡∏ö‡πâ‡∏≤‡∏ô 3 //
        "3": { 
            name: "Tales of Tanabata", 
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            },
            qrImage: "", 
            scriptUrl: "", 
            menu: [
                { id: 301, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: '' }

            ] 
        },

        // ‡∏ö‡πâ‡∏≤‡∏ô 4 //
        "4": { 
            name: "Eggy Egg Eggg", 
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            },
            qrImage: "", 
            scriptUrl: "", 
            menu: [
                { id: 401, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: '' }

            ] 
        },

        // ‡∏ö‡πâ‡∏≤‡∏ô 5 //
        "5": { 
            name: "Clause Bite", 
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            },
            qrImage: "", 
            scriptUrl: "", 
            menu: [
                { id: 501, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: '' }

            ] 
        },

        // ‡∏ö‡πâ‡∏≤‡∏ô 6 //
        "6": { 
            name: "Oktoberfest", 
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            }, 
            qrImage: "",
            scriptUrl: "", 
            menu: [
                { id: 601, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: '' }

            ] 
        },

        // ‡∏ö‡πâ‡∏≤‡∏ô 7 //
        "7": { 
            name: "La tominata festival", 
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBank)",
                accNo: "111-1-11111-1",
                accName: "‡∏ô‡∏≤‡∏¢ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ß‡∏±‡∏á ‡πÄ‡∏à‡πä‡∏á"
            }, 
            qrImage: "",
            scriptUrl: "", 
            menu: [
                { id: 701, name: '‡πÄ‡∏≠‡∏™‡πÄ‡∏û‡∏£‡∏™‡πÇ‡∏ã‡πà', price: 40, image: '' }

            ] 
        },
        
        // ‡∏ö‡πâ‡∏≤‡∏ô 8 //
        "8": {
            name: "Incredible india",
            bankDetails: {
                bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢",
                accNo: "223-8-96121-4",
                accName: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏ó‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡∏∞ ‡∏ô‡∏≤‡∏¢‡∏≠‡∏†‡∏¥‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏£‡∏±‡∏ï‡∏ô‡πå"
            },
            qrImage: "https://drive.google.com/thumbnail?id=1kdDcRFEdxd5xL6cKywwZpJoxyE_LBXal&sz=w800", 
            scriptUrl: "https://script.google.com/macros/s/AKfycbx31Z9UdyELzCUU4As7hSQHqM3F9NbstIm40kK6Vt_KkSydhF5yLU6KaknAhKZ1XfYKbQ/exec",
            menu: [
                { id: 801, name: '‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 59, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 802, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÅ‡∏¢‡∏°‡∏™‡∏ï‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡∏µ‡πà', price: 15, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 803, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÅ‡∏¢‡∏°‡∏™‡∏±‡∏á‡∏Ç‡∏¢‡∏≤‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢', price: 15, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 804, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÅ‡∏¢‡∏°‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï', price: 15, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 805, name: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå', price: 5, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 806, name: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å', price: 5, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 807, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤', price: 20, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 808, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏™‡∏•‡∏±‡∏î‡πÇ‡∏ö‡∏£‡∏≤‡∏ì', price: 20, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 809, name: '‡∏ä‡∏≤‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏°', price: 39, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 810, name: 'Holi glow tattoo bar', price: 5, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 811, name: 'Holi glow tattoo bar', price: 10, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 812, name: 'Holi glow tattoo bar', price: 15, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 813, name: 'Photobooth', price: 69, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
                { id: 814, name: '‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏≤‡∏≠‡∏±‡πä‡∏™‡∏™‡∏±‡πà‡∏á‡∏•‡∏∏‡∏¢999', price: 20, image: 'https://drive.google.com/thumbnail?id=1Gwa3d_fVroXdpS65zjR5YoCPSQDBA2CA&sz=w800' },
            ],
            promoGroups: [
                { 
                    //Combo ‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å‡πÅ‡∏•‡∏∞‡∏ä‡∏≤//
                    validCodes: ["COMBO89"], 
                    type: "flat",          
                    value: 9,              
                    description: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà 9 ‡∏ö‡∏≤‡∏ó" 
                },
                { 
                    //Combo ‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏≤999//
                    validCodes: ["US999"], 
                    type: "flat",          
                    value: 20,              
                    description: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏ü‡∏£‡∏µ‡∏≠‡∏µ‡∏Å 1 ‡∏£‡∏≠‡∏ö" 
                },
                { 
                    //Combo 67_1//
                    validCodes: ["671"], 
                    type: "flat",          
                    value: 7,              
                    description: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Photobooth ‡πÅ‡∏•‡∏∞ tattoo ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 67 ‡∏ö‡∏≤‡∏ó" 
                },
                { 
                    //Combo 67_2//
                    validCodes: ["672"], 
                    type: "flat",          
                    value: 12,              
                    description: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Photobooth ‡πÅ‡∏•‡∏∞ tattoo ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 67 ‡∏ö‡∏≤‡∏ó" 
                },
                { 
                    //Combo 67_3//
                    validCodes: ["673"], 
                    type: "flat",          
                    value: 17,              
                    description: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Photobooth ‡πÅ‡∏•‡∏∞ tattoo ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 67 ‡∏ö‡∏≤‡∏ó" 
                },

            ]
        }
    };

    const usersDB = [
        { username: 'baan1', password: 'hailnight', houseId: '1' },
        { username: 'baan2', password: 'hailnight', houseId: '2' },
        { username: 'baan3', password: 'hailnight', houseId: '3' },
        { username: 'baan4', password: 'hailnight', houseId: '4' },
        { username: 'baan5', password: 'hailnight', houseId: '5' },
        { username: 'baan6', password: 'hailnight', houseId: '6' },
        { username: 'baan7', password: 'hailnight', houseId: '7' },
        { username: 'baan8', password: 'hailnight', houseId: '8' }
    ];

    createApp({
        data() {
            return {
                loginForm: { username: '', password: '' },
                currentUser: null,
                currentMenu: [],
                currentScriptUrl: '',
                configName: '',
                currentBankDetails: { bankName: '', accNo: '', accName: '' }, 
                currentQrImage: '', // ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ QR Code ‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                currentPromoGroupsDB: [], 
                
                loginError: '',
                cart: [],
                
                queueNumber: '',
                customerName: '',
                promoCodeInput: '',
                appliedPromo: null,
                promoMessage: '',

                paymentModal: null,
                isLoading: false
            }
        },
        computed: {
            subTotal() { 
                return this.cart.reduce((sum, item) => sum + (item.price * item.qty), 0); 
            },
            discountAmount() {
                if (!this.appliedPromo) return 0;
                
                if (this.appliedPromo.type === 'flat') {
                    return this.appliedPromo.value;
                } else if (this.appliedPromo.type === 'percent') {
                    return Math.floor(this.subTotal * (this.appliedPromo.value / 100));
                }
                return 0;
            },
            totalPrice() {
                return Math.max(0, this.subTotal - this.discountAmount);
            }
        },
        mounted() {
            this.paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
        },
        methods: {
            login() {
                const user = usersDB.find(u => u.username === this.loginForm.username && u.password === this.loginForm.password);
                
                if (user) {
                    const config = houseConfigs[user.houseId];
                    if (config) {
                        this.currentUser = user;
                        this.currentMenu = config.menu;
                        this.currentScriptUrl = config.scriptUrl;
                        this.configName = config.name;
                        
                        this.currentBankDetails = config.bankDetails || { bankName: '-', accNo: '-', accName: '-' };
                        this.currentQrImage = config.qrImage || ''; // ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å config
                        this.currentPromoGroupsDB = config.promoGroups || [];

                        this.loginError = '';
                        this.resetOrderForm();
                    }
                } else {
                    this.loginError = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                }
            },
            logout() {
                this.currentUser = null;
                this.loginForm.username = '';
                this.loginForm.password = '';
                this.resetOrderForm();
            },
            resetOrderForm() {
                this.cart = [];
                this.queueNumber = '';
                this.customerName = '';
                this.removePromo();
            },
            addToCart(item) {
                const found = this.cart.find(i => i.id === item.id);
                if (found) found.qty++; else this.cart.push({ ...item, qty: 1 });
            },
            increaseQty(index) { this.cart[index].qty++; },
            decreaseQty(index) {
                if(this.cart[index].qty > 1) this.cart[index].qty--;
                else this.cart.splice(index, 1);
            },
            
            applyPromo() {
                if (!this.promoCodeInput.trim()) return;
                
                const inputCode = this.promoCodeInput.trim().toUpperCase();
                
                const foundPromo = this.currentPromoGroupsDB.find(p => 
                    p.validCodes.some(validCode => validCode.toUpperCase() === inputCode)
                );
                
                if (foundPromo) {
                    this.appliedPromo = foundPromo;
                    this.promoMessage = `‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${foundPromo.description}`;
                } else {
                    this.promoMessage = '‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ';
                    this.appliedPromo = null;
                }
            },
            removePromo() {
                this.appliedPromo = null;
                this.promoCodeInput = '';
                this.promoMessage = '';
            },

            showPaymentModal() {
                this.paymentModal.show();
            },
            confirmPayment() {
                if (!this.currentScriptUrl || this.currentScriptUrl.includes('xxxxxx')) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL Google Sheet');
                    return;
                }

                this.paymentModal.hide();
                this.isLoading = true;

                const orderData = {
                    houseId: this.currentUser.houseId,
                    queueNumber: this.queueNumber,
                    customerName: this.customerName || "-", 
                    items: this.cart,
                    total: this.totalPrice
                };

                fetch(this.currentScriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(orderData)
                })
                .then(() => {
                    this.isLoading = false;
                    this.resetOrderForm();
                    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                })
                .catch(error => {
                    this.isLoading = false;
                    alert('‚ùå ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error);
                });
            }
        }
    }).mount('#app');
</script>

</body>
</html>
